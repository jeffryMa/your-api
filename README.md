<p align="right">
   <strong>ä¸­æ–‡</strong> | <a href="./README.en.md">English</a>
</p>
<div align="center">

![yourapi](/web/public/logo.png)

# Your API

ğŸ¥æ–°ä¸€ä»£å¤§æ¨¡å‹ç½‘å…³ä¸AIèµ„äº§ç®¡ç†ç³»ç»Ÿ å…¨æ–°çš„é«˜é¢œå€¼/é«˜æ€§èƒ½çš„AIæ¨¡å‹æ¥å£ç®¡ç†ä¸åˆ†å‘ç³»ç»Ÿ

<a href="https://trendshift.io/repositories/8227" target="_blank"><img src="https://trendshift.io/api/badge/repositories/8227" alt="Calcium-Ion%2Fnew-api | Trendshift" style="width: 250px; height: 55px;" width="250" height="55"/></a>

<p align="center">
  <a href="https://raw.githubusercontent.com/Calcium-Ion/new-api/main/LICENSE">
    <img src="https://img.shields.io/github/license/Calcium-Ion/new-api?color=brightgreen" alt="license">
  </a>
  <a href="https://github.com/Calcium-Ion/new-api/releases/latest">
    <img src="https://img.shields.io/github/v/release/Calcium-Ion/new-api?color=brightgreen&include_prereleases" alt="release">
  </a>
  <a href="https://github.com/users/Calcium-Ion/packages/container/package/new-api">
    <img src="https://img.shields.io/badge/docker-ghcr.io-blue" alt="docker">
  </a>
  <a href="https://hub.docker.com/r/CalciumIon/new-api">
    <img src="https://img.shields.io/badge/docker-dockerHub-blue" alt="docker">
  </a>
  <a href="https://goreportcard.com/report/github.com/Calcium-Ion/new-api">
    <img src="https://goreportcard.com/badge/github.com/Calcium-Ion/new-api" alt="GoReportCard">
  </a>
</p>
</div>

## ğŸ“ é¡¹ç›®è¯´æ˜

![image-20250516152408326](./imgs/image-20250516152408326.png)

> [!NOTE]  
> æœ¬é¡¹ç›®ä¸ºå¼€æºé¡¹ç›®ï¼Œåœ¨[New API](https://github.com/Calcium-Ion/new-api.git)çš„åŸºç¡€ä¸Šè¿›è¡ŒäºŒæ¬¡å¼€å‘

> [!IMPORTANT]  
>
> - æœ¬é¡¹ç›®ä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ï¼Œä¸ä¿è¯ç¨³å®šæ€§ï¼Œä¸”ä¸æä¾›ä»»ä½•æŠ€æœ¯æ”¯æŒã€‚
> - ä½¿ç”¨è€…å¿…é¡»åœ¨éµå¾ª OpenAI çš„[ä½¿ç”¨æ¡æ¬¾](https://openai.com/policies/terms-of-use)ä»¥åŠ**æ³•å¾‹æ³•è§„**çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œä¸å¾—ç”¨äºéæ³•ç”¨é€”ã€‚
> - æ ¹æ®[ã€Šç”Ÿæˆå¼äººå·¥æ™ºèƒ½æœåŠ¡ç®¡ç†æš‚è¡ŒåŠæ³•ã€‹](http://www.cac.gov.cn/2023-07/13/c_1690898327029107.htm)çš„è¦æ±‚ï¼Œè¯·å‹¿å¯¹ä¸­å›½åœ°åŒºå…¬ä¼—æä¾›ä¸€åˆ‡æœªç»å¤‡æ¡ˆçš„ç”Ÿæˆå¼äººå·¥æ™ºèƒ½æœåŠ¡ã€‚

## å·®å¼‚è¯´æ˜

è¯¥é¡¹ç›®å°†æŒç»­åŒæ­¥[New API](https://github.com/Calcium-Ion/new-api.git)çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶è‡´åŠ›äºå¯¹å…¶åŠŸèƒ½è¿›è¡Œä¸æ–­æ‹“å±•ä¸ä¼˜åŒ–ã€‚é€šè¿‡é›†æˆæœ€æ–°æŠ€æœ¯å’Œæœ€ä½³å®è·µï¼Œç¡®ä¿APIçš„æ€§èƒ½ã€ç¨³å®šæ€§å’Œå¯æ‰©å±•æ€§æŒç»­æå‡ï¼Œæ»¡è¶³ä¸æ–­å˜åŒ–çš„ä¸šåŠ¡éœ€æ±‚å’ŒæŠ€æœ¯æŒ‘æˆ˜ã€‚

### å¢åŠ åŠä¼˜åŒ–

- [x]   é•œåƒæ”¯æŒarmä»¥åŠamd
- [x]   æ”¯æŒcozeæ™ºèƒ½ä½“çš„é…ç½®
- [x]   ğŸ¨æ•´ä½“ç•Œé¢é£æ ¼çš„å·®å¼‚
- [x]   é˜²æ­¢å›¾ç‰‡æ¢æµ‹è¯·æ±‚æš´éœ²ä¸Šæ¸¸
- [x]   æ¸ é“ç©ºå›å¤æ ¡éªŒï¼Œç¡®ä¿ç©ºå›å¤è¿›è¡Œé‡è¯•
- [x]   æ¨¡å‹ç¼–è¾‘å¤„æ”¯æŒå¤škeyè½®è¯¢
- [x]   å¯¹å•ä¸ªæ¸ é“æ–°å¢ä»£ç†ipæ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨å›ºå®šä»£ç†ipå¯¹æ¸ é“è¿›è¡Œè¯·æ±‚ï¼Œæå‡å®‰å…¨æ€§
- [x]   æ”¯æŒå›¾ç‰‡è¯»å–çš„ä»£ç†ipé…ç½®
- [x]   å¢åŠ å¿«é€Ÿæ¥å…¥æŒ‡å—
- [x]   å¢åŠ å¼€å‘æ–‡æ¡£ç‹¬ç«‹é¡µæ”¯æŒ
- [x]  å¢åŠ é¦–é¡µæ¨¡å‹ä¾›åº”å•†æ˜¾ç¤º
- [x] ç§»åŠ¨ç«¯é€‚é…
- [x] æ¨¡å‹ä»·æ ¼æ˜¾ç¤ºä¼˜åŒ–ï¼Œæ›´ç°ä»£åŒ–çš„è®¾è®¡ï¼Œæ”¯æŒé…ç½®æ¨¡å‹æè¿°
- [x] æ”¯æŒAIä¾›åº”å•†çš„é…ç½®
- [x] æ”¯æŒæ¨¡å‹æè¿°çš„é…ç½®
- [x] é¦–é¡µä¼˜åŠ¿è¿è¥æ–‡æ¡ˆå¯é…ç½®
- [x] å¯è‡ªå®šä¹‰å¯¼èˆªé“¾æ¥
- [x] å¢åŠ ClaudeåŸç”ŸAPIæ ¼å¼è¯·æ±‚æ”¯æŒ
- [x] ä¼˜åŒ–éƒ¨åˆ†ç•Œé¢å…ƒç´ çš„è¾¹è·é¿å…æŒ¤åœ¨ä¸€èµ·
- [x] ä¼˜åŒ–å…¬å‘Šæ˜¾ç¤º
- [x] é¢„è®¾æ›´å¤šæ¨¡å‹
- [x] å‰ç«¯æ–°å¢tailwind cssä»¥åŠreduxæ”¯æŒï¼Œæ›´ä¾¿äºæ•æ·å¼€å‘
- [x] æ–°å¢å¿«é€Ÿæ¥å…¥çš„è¯´æ˜
- [x] å…¼å®¹newapiæ•°æ®åº“

**æ¬¢è¿æäº¤ Issueã€Pull Requestï¼ˆPRï¼‰ã€Merge Requestï¼ˆMRï¼‰æˆ–æå‡ºå„ç±»éœ€æ±‚ä¸å»ºè®®ã€‚æˆ‘ä»¬éå¸¸é‡è§†æ‚¨çš„åé¦ˆï¼Œå¹¶æœŸå¾…ä¸æ‚¨å…±åŒå®Œå–„é¡¹ç›®ã€‚**

cozeå·¥ä½œæµçš„é…ç½®

![image-20250517003351383](./imgs/image-20250517003351383.png)

## ä½¿ç”¨è¯´æ˜

#### ç›´æ¥ä½¿ç”¨Dockeré•œåƒ

```shell
# ä½¿ç”¨SQLite
# ä¸ä½¿ç”¨ç›®å½•æŒ‚è½½
docker run --name yourapi -d --restart always -p 3000:3000 -e TZ=Asia/Shanghai yourapi/yourapi:latest
# ä½¿ç”¨æŒ‚è½½ç›®å½•
docker run --name yourapi -d --restart always -p 3000:3000 -e TZ=Asia/Shanghai -v /home/ubuntu/data/new-api:/data yourapi/yourapi:latest

# ä½¿ç”¨MySQL
docker run --name yourapi -d --restart always -p 3000:3000 -e SQL_DSN="root:123456@tcp(localhost:3306)/yourapi" -e TZ=Asia/Shanghai -v /home/ubuntu/data/new-api:/data yourapi/yourapi:latest
```

#### ä½¿ç”¨docker-compose

åœ¨æ‚¨çš„æœåŠ¡å™¨æ–°å»º`docker-compose.yml`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```yaml
version: '3.4'

services:
  yourapi:
    image: yourapi/yourapi:latest
    container_name: yourapi
    restart: always
    command: --log-dir /app/logs
    ports:
      - "3000:3000"
    volumes:
      - ./data:/data
      - ./logs:/app/logs
    environment:
      - SQL_DSN=root:123456@tcp(mysql:3306)/yourapi?charset=utf8mb4&parseTime=True&loc=Local  # ä¿®æ”¹æ­¤è¡Œï¼Œæˆ–æ³¨é‡Šæ‰ä»¥ä½¿ç”¨ SQLite ä½œä¸ºæ•°æ®åº“
      - REDIS_CONN_STRING=redis://redis # ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œä¾‹å¦‚ redis://user:password@localhost:6379/0
      - TZ=Asia/Shanghai
      - ERROR_LOG_ENABLED=true # æ˜¯å¦å¯ç”¨é”™è¯¯æ—¥å¿—è®°å½•
    #      - TIKTOKEN_CACHE_DIR=./tiktoken_cache  # å¦‚æœéœ€è¦ä½¿ç”¨tiktoken_cacheï¼Œè¯·å–æ¶ˆæ³¨é‡Š
    #      - SESSION_SECRET=random_string  # å¤šæœºéƒ¨ç½²æ—¶è®¾ç½®ï¼Œå¿…é¡»ä¿®æ”¹è¿™ä¸ªéšæœºå­—ç¬¦ä¸²ï¼ï¼ï¼ï¼ï¼ï¼ï¼
    #      - NODE_TYPE=slave  # Uncomment for slave node in multi-node deployment
    #      - SYNC_FREQUENCY=60  # Uncomment if regular database syncing is needed
    #      - FRONTEND_BASE_URL=https://openai.justsong.cn  # Uncomment for multi-node deployment with front-end URL

    depends_on:
      - redis
      - mysql
    healthcheck:
      test: ["CMD-SHELL", "wget -q -O - http://localhost:3000/api/status | grep -o '\"success\":\\s*true' | awk -F: '{print $$2}'"]
      interval: 30s
      timeout: 10s
      retries: 3

  redis:
    image: redis:latest
    container_name: redis
    restart: always

  mysql:
    image: mysql:8.2
    container_name: mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 123456  # Ensure this matches the password in SQL_DSN
      MYSQL_DATABASE: yourapi
    volumes:
      - mysql_data:/var/lib/mysql
    # ports:
    #   - "3306:3306"  # If you want to access MySQL from outside Docker, uncomment

volumes:
  mysql_data:
```



å¯åŠ¨æœåŠ¡ï¼š

```
docker-compose up -d
```



è®¿é—®`http://ip:3000`å³å¯çœ‹åˆ°ç™»å½•ç•Œé¢ï¼Œè¾“å…¥è´¦å·å¯†ç å³å¯ç™»å½•ï¼ˆé»˜è®¤è´¦å·ï¼šrootï¼Œé»˜è®¤å¯†ç ï¼š123456ï¼‰ã€‚

è‹¥æœ‰ç‰ˆæœ¬æ›´æ–°ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ›´æ–°å¹¶é‡å¯æœåŠ¡ï¼š

```
docker-compose pull && docker-compose up -d
```

## åŠ ç¾¤äº¤æµ

> æ‚¨ä¹Ÿå¯ä»¥æ‰«æä¸‹æ–¹äºŒç»´ç åŠ å…¥QQäº¤æµç¾¤ä»¥è·å–æœ€æ–°çš„å¼€å‘åŠ¨æ€å’Œç›¸å…³äº‹ä»¶
>
> ç‚¹å‡»é“¾æ¥åŠ å…¥ç¾¤èŠï¼šhttps://qm.qq.com/q/jkdefoHcNG

  <img src="./imgs/image-20250516160329904.png" alt="image-20250516160329904" width="400">



# âœ¨ ä¸»è¦ç‰¹æ€§

Your APIæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œè¯¦ç»†ç‰¹æ€§è¯·å‚è€ƒ[ç‰¹æ€§è¯´æ˜](https://docs.newapi.pro/wiki/features-introduction)ï¼š

1. ğŸ¨ å…¨æ–°çš„UIç•Œé¢
2. ğŸŒ å¤šè¯­è¨€æ”¯æŒ
3. ğŸ’° æ”¯æŒåœ¨çº¿å……å€¼åŠŸèƒ½ï¼ˆæ˜“æ”¯ä»˜ï¼‰
5. ğŸ”„ å…¼å®¹åŸç‰ˆOne APIçš„æ•°æ®åº“
6. ğŸ’µ æ”¯æŒæ¨¡å‹æŒ‰æ¬¡æ•°æ”¶è´¹
7. âš–ï¸ æ”¯æŒæ¸ é“åŠ æƒéšæœº
8. ğŸ“ˆ æ•°æ®çœ‹æ¿ï¼ˆæ§åˆ¶å°ï¼‰
9. ğŸ”’ ä»¤ç‰Œåˆ†ç»„ã€æ¨¡å‹é™åˆ¶
10. ğŸ¤– æ”¯æŒæ›´å¤šæˆæƒç™»é™†æ–¹å¼ï¼ˆLinuxDO,Telegramã€OIDCï¼‰
11. ğŸ”„ æ”¯æŒRerankæ¨¡å‹ï¼ˆCohereå’ŒJinaï¼‰ï¼Œ[æ¥å£æ–‡æ¡£](https://docs.newapi.pro/api/jinaai-rerank)
12. âš¡ æ”¯æŒOpenAI Realtime APIï¼ˆåŒ…æ‹¬Azureæ¸ é“ï¼‰ï¼Œ[æ¥å£æ–‡æ¡£](https://docs.newapi.pro/api/openai-realtime)
13. âš¡ æ”¯æŒClaude Messages æ ¼å¼ï¼Œ[æ¥å£æ–‡æ¡£](https://docs.newapi.pro/api/anthropic-chat)
14. æ”¯æŒä½¿ç”¨è·¯ç”±/chat2linkè¿›å…¥èŠå¤©ç•Œé¢
15. ğŸ§  æ”¯æŒé€šè¿‡æ¨¡å‹åç§°åç¼€è®¾ç½® reasoning effortï¼š
    1. OpenAI oç³»åˆ—æ¨¡å‹
        - æ·»åŠ åç¼€ `-high` è®¾ç½®ä¸º high reasoning effort (ä¾‹å¦‚: `o3-mini-high`)
        - æ·»åŠ åç¼€ `-medium` è®¾ç½®ä¸º medium reasoning effort (ä¾‹å¦‚: `o3-mini-medium`)
        - æ·»åŠ åç¼€ `-low` è®¾ç½®ä¸º low reasoning effort (ä¾‹å¦‚: `o3-mini-low`)
    2. Claude æ€è€ƒæ¨¡å‹
        - æ·»åŠ åç¼€ `-thinking` å¯ç”¨æ€è€ƒæ¨¡å¼ (ä¾‹å¦‚: `claude-3-7-sonnet-20250219-thinking`)
16. ğŸ”„ æ€è€ƒè½¬å†…å®¹åŠŸèƒ½
17. ğŸ”„ é’ˆå¯¹ç”¨æˆ·çš„æ¨¡å‹é™æµåŠŸèƒ½
18. ğŸ’° ç¼“å­˜è®¡è´¹æ”¯æŒï¼Œå¼€å¯åå¯ä»¥åœ¨ç¼“å­˜å‘½ä¸­æ—¶æŒ‰ç…§è®¾å®šçš„æ¯”ä¾‹è®¡è´¹ï¼š
    1. åœ¨ `ç³»ç»Ÿè®¾ç½®-è¿è¥è®¾ç½®` ä¸­è®¾ç½® `æç¤ºç¼“å­˜å€ç‡` é€‰é¡¹
    2. åœ¨æ¸ é“ä¸­è®¾ç½® `æç¤ºç¼“å­˜å€ç‡`ï¼ŒèŒƒå›´ 0-1ï¼Œä¾‹å¦‚è®¾ç½®ä¸º 0.5 è¡¨ç¤ºç¼“å­˜å‘½ä¸­æ—¶æŒ‰ç…§ 50% è®¡è´¹
    3. æ”¯æŒçš„æ¸ é“ï¼š
        - [x] OpenAI
        - [x] Azure
        - [x] DeepSeek
        - [x] Claude

## æ¨¡å‹æ”¯æŒ

æ­¤ç‰ˆæœ¬æ”¯æŒå¤šç§æ¨¡å‹ï¼Œè¯¦æƒ…è¯·å‚è€ƒ[æ¥å£æ–‡æ¡£-ä¸­ç»§æ¥å£](https://docs.newapi.pro/api)ï¼š

1. ç¬¬ä¸‰æ–¹æ¨¡å‹ **gpts** ï¼ˆgpt-4-gizmo-*ï¼‰
2. ç¬¬ä¸‰æ–¹æ¸ é“[Midjourney-Proxy(Plus)](https://github.com/novicezk/midjourney-proxy)æ¥å£ï¼Œ[æ¥å£æ–‡æ¡£](https://docs.newapi.pro/api/midjourney-proxy-image)
3. ç¬¬ä¸‰æ–¹æ¸ é“[Suno API](https://github.com/Suno-API/Suno-API)æ¥å£ï¼Œ[æ¥å£æ–‡æ¡£](https://docs.newapi.pro/api/suno-music)
4. è‡ªå®šä¹‰æ¸ é“ï¼Œæ”¯æŒå¡«å…¥å®Œæ•´è°ƒç”¨åœ°å€
5. Rerankæ¨¡å‹ï¼ˆ[Cohere](https://cohere.ai/)å’Œ[Jina](https://jina.ai/)ï¼‰ï¼Œ[æ¥å£æ–‡æ¡£](https://docs.newapi.pro/api/jinaai-rerank)
6. Claude Messages æ ¼å¼ï¼Œ[æ¥å£æ–‡æ¡£](https://docs.newapi.pro/api/anthropic-chat)
7. Difyï¼Œå½“å‰ä»…æ”¯æŒchatflow

## ç¯å¢ƒå˜é‡é…ç½®

### åŸºæœ¬é…ç½®

| ç¯å¢ƒå˜é‡ | è¯´æ˜         | é»˜è®¤å€¼          | ç¤ºä¾‹                  |
| :------- | :----------- | :-------------- | :-------------------- |
| `PORT`   | æœåŠ¡ç›‘å¬ç«¯å£ | `3000`          | `PORT=8080`           |
| `TZ`     | æ—¶åŒºè®¾ç½®     | `Asia/Shanghai` | `TZ=America/New_York` |

### ğŸ’¾ æ•°æ®åº“é…ç½®

| ç¯å¢ƒå˜é‡                | è¯´æ˜                       | é»˜è®¤å€¼                   | ç¤ºä¾‹                                                      |
| :---------------------- | :------------------------- | :----------------------- | :-------------------------------------------------------- |
| `SQL_DSN`               | æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²           | SQLite (data/one-api.db) | `SQL_DSN=root:123456@tcp(localhost:3306)/oneapi`          |
| `SQL_MAX_IDLE_CONNS`    | ç©ºé—²è¿æ¥æ± æœ€å¤§è¿æ¥æ•°       | `100`                    | `SQL_MAX_IDLE_CONNS=50`                                   |
| `SQL_MAX_OPEN_CONNS`    | è¿æ¥æ± æœ€å¤§æ‰“å¼€è¿æ¥æ•°       | `1000`                   | `SQL_MAX_OPEN_CONNS=500`                                  |
| `SQL_CONN_MAX_LIFETIME` | è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ(åˆ†é’Ÿ)     | `60`                     | `SQL_CONN_MAX_LIFETIME=120`                               |
| `LOG_SQL_DSN`           | æ—¥å¿—è¡¨ç‹¬ç«‹æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² | -                        | `LOG_SQL_DSN=root:123456@tcp(localhost:3306)/oneapi_logs` |
| `SQLITE_BUSY_TIMEOUT`   | SQLiteé”ç­‰å¾…è¶…æ—¶(æ¯«ç§’)     | `3000`                   | `SQLITE_BUSY_TIMEOUT=5000`                                |

### ğŸ“¦ ç¼“å­˜é…ç½®

| ç¯å¢ƒå˜é‡                | è¯´æ˜                     | é»˜è®¤å€¼  | ç¤ºä¾‹                                                       |
| :---------------------- | :----------------------- | :------ | :--------------------------------------------------------- |
| `REDIS_CONN_STRING`     | Redisè¿æ¥å­—ç¬¦ä¸²          | -       | `REDIS_CONN_STRING=redis://default:redispw@localhost:6379` |
| `MEMORY_CACHE_ENABLED`  | æ˜¯å¦å¯ç”¨å†…å­˜ç¼“å­˜         | `false` | `MEMORY_CACHE_ENABLED=true`                                |
| `REDIS_CONN_POOL_SIZE`  | Redisè¿æ¥æ± å¤§å°          | -       | `REDIS_CONN_POOL_SIZE=10`                                  |
| `REDIS_PASSWORD`        | Redisé›†ç¾¤æˆ–å“¨å…µæ¨¡å¼å¯†ç   | -       | `REDIS_PASSWORD=your_password`                             |
| `REDIS_MASTER_NAME`     | Rediså“¨å…µæ¨¡å¼ä¸»èŠ‚ç‚¹åç§°  | -       | `REDIS_MASTER_NAME=mymaster`                               |
| `BATCH_UPDATE_ENABLED`  | å¯ç”¨æ•°æ®åº“æ‰¹é‡æ›´æ–°èšåˆ   | `false` | `BATCH_UPDATE_ENABLED=true`                                |
| `BATCH_UPDATE_INTERVAL` | æ‰¹é‡æ›´æ–°èšåˆæ—¶é—´é—´éš”(ç§’) | `5`     | `BATCH_UPDATE_INTERVAL=10`                                 |

### ğŸŒ å¤šèŠ‚ç‚¹ä¸å®‰å…¨é…ç½®

| ç¯å¢ƒå˜é‡                    | è¯´æ˜                         | é»˜è®¤å€¼   | ç¤ºä¾‹                                        |
| :-------------------------- | :--------------------------- | :------- | :------------------------------------------ |
| `SESSION_SECRET`            | ä¼šè¯å¯†é’¥(å¤šæœºéƒ¨ç½²å¿…é¡»)       | -        | `SESSION_SECRET=random_string`              |
| `CRYPTO_SECRET`             | åŠ å¯†å¯†é’¥(åŠ å¯†æ•°æ®åº“å†…å®¹)     | -        | `CRYPTO_SECRET=your_crypto_secret`          |
| `FRONTEND_BASE_URL`         | å‰ç«¯åŸºç¡€URL                  | -        | `FRONTEND_BASE_URL=https://your-domain.com` |
| `SYNC_FREQUENCY`            | ç¼“å­˜ä¸æ•°æ®åº“åŒæ­¥é¢‘ç‡(ç§’)     | `600`    | `SYNC_FREQUENCY=60`                         |
| `NODE_TYPE`                 | èŠ‚ç‚¹ç±»å‹                     | `master` | `NODE_TYPE=slave`                           |
| `INITIAL_ROOT_TOKEN`        | é¦–æ¬¡å¯åŠ¨æ—¶åˆ›å»ºçš„rootç”¨æˆ·ä»¤ç‰Œ | -        | `INITIAL_ROOT_TOKEN=your_token`             |
| `INITIAL_ROOT_ACCESS_TOKEN` | é¦–æ¬¡å¯åŠ¨æ—¶åˆ›å»ºçš„ç³»ç»Ÿç®¡ç†ä»¤ç‰Œ | -        | `INITIAL_ROOT_ACCESS_TOKEN=your_token`      |

é›†ç¾¤éƒ¨ç½²

å…³äºå¦‚ä½•ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡æ„å»ºå®Œæ•´çš„é›†ç¾¤éƒ¨ç½²ï¼Œè¯·å‚è€ƒ[é›†ç¾¤éƒ¨ç½²æŒ‡å—](https://docs.newapi.pro/installation/cluster-deployment/)ã€‚

### ğŸ‘¤ ç”¨æˆ·åŠä»¤ç‰Œé…ç½®

| ç¯å¢ƒå˜é‡                             | è¯´æ˜                         | é»˜è®¤å€¼  | ç¤ºä¾‹                                    |
| :----------------------------------- | :--------------------------- | :------ | :-------------------------------------- |
| `DEFAULT_QUOTA`                      | æ–°ç”¨æˆ·é»˜è®¤é…é¢               | `0`     | `DEFAULT_QUOTA=10`                      |
| `GLOBAL_USER_QUOTA`                  | å…¨å±€ç”¨æˆ·é…é¢é™åˆ¶             | -       | `GLOBAL_USER_QUOTA=100`                 |
| `GENERATE_DEFAULT_TOKEN`             | ä¸ºæ–°æ³¨å†Œç”¨æˆ·ç”Ÿæˆåˆå§‹ä»¤ç‰Œ     | `false` | `GENERATE_DEFAULT_TOKEN=true`           |
| `NOTIFICATION_LIMIT_DURATION_MINUTE` | é€šçŸ¥é™åˆ¶çš„æŒç»­æ—¶é—´(åˆ†é’Ÿ)     | `10`    | `NOTIFICATION_LIMIT_DURATION_MINUTE=15` |
| `NOTIFY_LIMIT_COUNT`                 | æŒ‡å®šæŒç»­æ—¶é—´å†…çš„æœ€å¤§é€šçŸ¥æ•°é‡ | `2`     | `NOTIFY_LIMIT_COUNT=3`                  |

### ğŸš¦ è¯·æ±‚é™åˆ¶é…ç½®

| ç¯å¢ƒå˜é‡                       | è¯´æ˜                        | é»˜è®¤å€¼ | ç¤ºä¾‹                              |
| :----------------------------- | :-------------------------- | :----- | :-------------------------------- |
| `GLOBAL_API_RATE_LIMIT`        | å…¨å±€APIé€Ÿç‡é™åˆ¶(å•IPä¸‰åˆ†é’Ÿ) | `180`  | `GLOBAL_API_RATE_LIMIT=100`       |
| `GLOBAL_WEB_RATE_LIMIT`        | å…¨å±€Webé€Ÿç‡é™åˆ¶(å•IPä¸‰åˆ†é’Ÿ) | `60`   | `GLOBAL_WEB_RATE_LIMIT=30`        |
| `RELAY_TIMEOUT`                | ä¸­ç»§è¯·æ±‚è¶…æ—¶æ—¶é—´(ç§’)        | -      | `RELAY_TIMEOUT=60`                |
| `USER_CONTENT_REQUEST_TIMEOUT` | ç”¨æˆ·å†…å®¹ä¸‹è½½è¶…æ—¶æ—¶é—´(ç§’)    | -      | `USER_CONTENT_REQUEST_TIMEOUT=30` |
| `STREAMING_TIMEOUT`            | æµå¼ä¸€æ¬¡å›å¤çš„è¶…æ—¶æ—¶é—´(ç§’)  | `60`   | `STREAMING_TIMEOUT=120`           |
| `MAX_FILE_DOWNLOAD_MB`         | æœ€å¤§æ–‡ä»¶ä¸‹è½½å¤§å°(MB)        | `20`   | `MAX_FILE_DOWNLOAD_MB=50`         |

RELAY_TIMEOUT è®¾ç½®è­¦å‘Š

è®¾ç½® `RELAY_TIMEOUT` ç¯å¢ƒå˜é‡æ—¶è¯·è°¨æ…ï¼Œå¦‚æœè®¾ç½®è¿‡çŸ­å¯èƒ½å¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š

- ä¸Šæ¸¸APIå·²ç»å®Œæˆè¯·æ±‚å¹¶è®¡è´¹ï¼Œä½†æœ¬åœ°å› è¶…æ—¶è€Œæœªå®Œæˆè®¡è´¹
- é€ æˆè®¡è´¹ä¸åŒæ­¥ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»ŸäºæŸ
- å»ºè®®ä¸è®¾ç½®ï¼Œé™¤éæ‚¨çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆ

### ğŸ“¡ æ¸ é“ç®¡ç†é…ç½®

| ç¯å¢ƒå˜é‡                        | è¯´æ˜                       | é»˜è®¤å€¼                             | ç¤ºä¾‹                                |
| :------------------------------ | :------------------------- | :--------------------------------- | :---------------------------------- |
| `CHANNEL_UPDATE_FREQUENCY`      | å®šæœŸæ›´æ–°æ¸ é“ä½™é¢(åˆ†é’Ÿ)     | -                                  | `CHANNEL_UPDATE_FREQUENCY=1440`     |
| `CHANNEL_TEST_FREQUENCY`        | å®šæœŸæ£€æŸ¥æ¸ é“(åˆ†é’Ÿ)         | -                                  | `CHANNEL_TEST_FREQUENCY=1440`       |
| `POLLING_INTERVAL`              | æ‰¹é‡æ›´æ–°æ¸ é“æ—¶è¯·æ±‚é—´éš”(ç§’) | `0`                                | `POLLING_INTERVAL=5`                |
| `ENABLE_METRIC`                 | æ˜¯å¦æ ¹æ®è¯·æ±‚æˆåŠŸç‡ç¦ç”¨æ¸ é“ | `false`                            | `ENABLE_METRIC=true`                |
| `METRIC_QUEUE_SIZE`             | è¯·æ±‚æˆåŠŸç‡ç»Ÿè®¡é˜Ÿåˆ—å¤§å°     | `10`                               | `METRIC_QUEUE_SIZE=20`              |
| `METRIC_SUCCESS_RATE_THRESHOLD` | è¯·æ±‚æˆåŠŸç‡é˜ˆå€¼             | `0.8`                              | `METRIC_SUCCESS_RATE_THRESHOLD=0.7` |
| `TEST_PROMPT`                   | æµ‹è¯•æ¨¡å‹æ—¶çš„ç”¨æˆ·prompt     | `Print your model name exactly...` | `TEST_PROMPT=Hello`                 |

### ğŸ¤– æ¨¡å‹å’Œè¯·æ±‚å¤„ç†é…ç½®

| ç¯å¢ƒå˜é‡                     | è¯´æ˜                                                 | é»˜è®¤å€¼  | ç¤ºä¾‹                                 |
| :--------------------------- | :--------------------------------------------------- | :------ | :----------------------------------- |
| `FORCE_STREAM_OPTION`        | è¦†ç›–å®¢æˆ·ç«¯stream_optionså‚æ•°                         | `true`  | `FORCE_STREAM_OPTION=false`          |
| `GET_MEDIA_TOKEN`            | æ˜¯å¦ç»Ÿè®¡å›¾ç‰‡token                                    | `true`  | `GET_MEDIA_TOKEN=false`              |
| `GET_MEDIA_TOKEN_NOT_STREAM` | éæµæ¨¡å¼ä¸‹æ˜¯å¦ç»Ÿè®¡å›¾ç‰‡token                          | `true`  | `GET_MEDIA_TOKEN_NOT_STREAM=false`   |
| `UPDATE_TASK`                | æ˜¯å¦æ›´æ–°å¼‚æ­¥ä»»åŠ¡(MJã€Suno)                           | `true`  | `UPDATE_TASK=false`                  |
| `ENFORCE_INCLUDE_USAGE`      | å¼ºåˆ¶streamæ¨¡å¼ä¸‹è¿”å›usage                            | `false` | `ENFORCE_INCLUDE_USAGE=true`         |
| `TIKTOKEN_CACHE_DIR`         | Tiktokenç¼–ç å™¨ç¼“å­˜ç›®å½•ï¼Œç”¨äºå­˜æ”¾åˆ†è¯æ–‡ä»¶é¿å…ç½‘ç»œä¸‹è½½ | -       | `TIKTOKEN_CACHE_DIR=/cache/tiktoken` |
| `DATA_GYM_CACHE_DIR`         | DataGymç¼“å­˜ç›®å½•                                      | -       | `DATA_GYM_CACHE_DIR=/cache/data_gym` |

Tiktokenæ–‡ä»¶é…ç½®

ä¸‹è½½tiktokenæ–‡ä»¶åï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ–¹å¼é‡å‘½åï¼š

- `cl100k_base.tiktoken` é‡å‘½åä¸º `9b5ad71b2ce5302211f9c61530b329a4922fc6a4`
- `o200k_base.tiktoken` é‡å‘½åä¸º `fb374d419588a4632f3f557e76b4b70aebbca790`

è¿™äº›æ–‡ä»¶åº”æ”¾ç½®åœ¨`TIKTOKEN_CACHE_DIR`æŒ‡å®šçš„ç›®å½•ä¸­ï¼Œä»¥æé«˜tokenè®¡ç®—æ€§èƒ½å¹¶å‡å°‘ç½‘ç»œä¾èµ–ã€‚

Tiktokené…ç½®ç¤ºä¾‹

```
# Dockerç¯å¢ƒç¤ºä¾‹
TIKTOKEN_CACHE_DIR=/app/data/tiktoken

# ç„¶åå°†tiktokenæ–‡ä»¶ä¸‹è½½å¹¶é‡å‘½ååæ”¾å…¥è¯¥ç›®å½•ï¼š
/app/data/tiktoken/9b5ad71b2ce5302211f9c61530b329a4922fc6a4
/app/data/tiktoken/fb374d419588a4632f3f557e76b4b70aebbca790
```

Tiktokenæ˜¯OpenAIä½¿ç”¨çš„åˆ†è¯å™¨ï¼Œç”¨äºè®¡ç®—æ–‡æœ¬çš„tokenæ•°é‡ã€‚é€šè¿‡æœ¬åœ°ç¼“å­˜è¿™äº›æ–‡ä»¶ï¼Œå¯ä»¥é¿å…ç³»ç»Ÿæ¯æ¬¡å¯åŠ¨æ—¶ä»ç½‘ç»œä¸‹è½½ï¼Œæé«˜ç¨³å®šæ€§å’Œæ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œå—é™ç¯å¢ƒä¸­ã€‚

### ğŸ” ç‰¹å®šæ¨¡å‹é…ç½®

| ç¯å¢ƒå˜é‡                      | è¯´æ˜                         | é»˜è®¤å€¼               | ç¤ºä¾‹                                   |
| :---------------------------- | :--------------------------- | :------------------- | :------------------------------------- |
| `AZURE_DEFAULT_API_VERSION`   | Azureæ¸ é“é»˜è®¤APIç‰ˆæœ¬         | `2024-12-01-preview` | `AZURE_DEFAULT_API_VERSION=2023-05-15` |
| `COHERE_SAFETY_SETTING`       | Cohereæ¨¡å‹å®‰å…¨è®¾ç½®           | `NONE`               | `COHERE_SAFETY_SETTING=CONTEXTUAL`     |
| `GEMINI_VISION_MAX_IMAGE_NUM` | Geminiæ¨¡å‹æœ€å¤§å›¾ç‰‡æ•°é‡       | `16`                 | `GEMINI_VISION_MAX_IMAGE_NUM=8`        |
| `GEMINI_VERSION`              | Geminiç‰ˆæœ¬                   | `v1`                 | `GEMINI_VERSION=v1beta`                |
| `DIFY_DEBUG`                  | Difyæ¸ é“è¾“å‡ºå·¥ä½œæµå’ŒèŠ‚ç‚¹ä¿¡æ¯ | `true`               | `DIFY_DEBUG=false`                     |

### ğŸ“¨ å…¶ä»–é…ç½®

| ç¯å¢ƒå˜é‡         | è¯´æ˜           | é»˜è®¤å€¼ | ç¤ºä¾‹                               |
| :--------------- | :------------- | :----- | :--------------------------------- |
| `EMAIL_SERVER`   | é‚®ä»¶æœåŠ¡å™¨é…ç½® | -      | `EMAIL_SERVER=smtp.example.com:25` |
| `EMAIL_FROM`     | é‚®ä»¶å‘é€è€…åœ°å€ | -      | `EMAIL_FROM=noreply@example.com`   |
| `EMAIL_PASSWORD` | é‚®ä»¶æœåŠ¡å™¨å¯†ç  | -      | `EMAIL_PASSWORD=yourpassword`      |

# ğŸŒ å¤šæœºéƒ¨ç½²ç¤ºä¾‹

åœ¨å¤šæœºéƒ¨ç½²åœºæ™¯ä¸­ï¼Œå¿…é¡»è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

## ğŸ‘‘ ä¸»èŠ‚ç‚¹é…ç½®

```
# æ•°æ®åº“é…ç½® - ä½¿ç”¨è¿œç¨‹æ•°æ®åº“
SQL_DSN=root:password@tcp(db-server:3306)/oneapi

# å®‰å…¨é…ç½®
SESSION_SECRET=your_unique_session_secret
CRYPTO_SECRET=your_unique_crypto_secret

# Redisç¼“å­˜é…ç½®
REDIS_CONN_STRING=redis://default:password@redis-server:6379
```

## ğŸ‘¥ ä»èŠ‚ç‚¹é…ç½®

```
# æ•°æ®åº“é…ç½® - ä½¿ç”¨ç›¸åŒçš„è¿œç¨‹æ•°æ®åº“
SQL_DSN=root:password@tcp(db-server:3306)/oneapi

# å®‰å…¨é…ç½® - ä¸ä¸»èŠ‚ç‚¹ä½¿ç”¨ç›¸åŒçš„å¯†é’¥
SESSION_SECRET=your_unique_session_secret
CRYPTO_SECRET=your_unique_crypto_secret

# Redisç¼“å­˜é…ç½® - ä¸ä¸»èŠ‚ç‚¹ä½¿ç”¨ç›¸åŒçš„Redis
REDIS_CONN_STRING=redis://default:password@redis-server:6379

# èŠ‚ç‚¹ç±»å‹è®¾ç½®
NODE_TYPE=slave

# å¯é€‰ï¼šå‰ç«¯åŸºç¡€URL
FRONTEND_BASE_URL=https://your-domain.com

# å¯é€‰ï¼šåŒæ­¥é¢‘ç‡
SYNC_FREQUENCY=60
```

# éƒ¨ç½²

è¯¦ç»†éƒ¨ç½²æŒ‡å—è¯·å‚è€ƒï¼š

> [!TIP]
> æœ€æ–°ç‰ˆDockeré•œåƒï¼š`yourapi/yourapi:latest`  

### å¤šæœºéƒ¨ç½²æ³¨æ„äº‹é¡¹
- å¿…é¡»è®¾ç½®ç¯å¢ƒå˜é‡ `SESSION_SECRET`ï¼Œå¦åˆ™ä¼šå¯¼è‡´å¤šæœºéƒ¨ç½²æ—¶ç™»å½•çŠ¶æ€ä¸ä¸€è‡´
- å¦‚æœå…¬ç”¨Redisï¼Œå¿…é¡»è®¾ç½® `CRYPTO_SECRET`ï¼Œå¦åˆ™ä¼šå¯¼è‡´å¤šæœºéƒ¨ç½²æ—¶Rediså†…å®¹æ— æ³•è·å–

### éƒ¨ç½²è¦æ±‚
- æœ¬åœ°æ•°æ®åº“ï¼ˆé»˜è®¤ï¼‰ï¼šSQLiteï¼ˆDockeréƒ¨ç½²å¿…é¡»æŒ‚è½½`/data`ç›®å½•ï¼‰
- è¿œç¨‹æ•°æ®åº“ï¼šMySQLç‰ˆæœ¬ >= 5.7.8ï¼ŒPgSQLç‰ˆæœ¬ >= 9.6

### éƒ¨ç½²æ–¹å¼

#### ä½¿ç”¨Docker Composeéƒ¨ç½²
```shell
# ä¸‹è½½é¡¹ç›®
git clone https://github.com/your-api/your-api.git
cd your-api
# æŒ‰éœ€ç¼–è¾‘docker-compose.yml
# å¯åŠ¨
docker-compose up -d
```

#### ç›´æ¥ä½¿ç”¨Dockeré•œåƒ
```shell
# ä½¿ç”¨SQLite
docker run --name yourapi -d --restart always -p 3000:3000 -e TZ=Asia/Shanghai -v /home/ubuntu/data/yourapi:/data yourapi/yourapi:latest

# ä½¿ç”¨MySQL
docker run --name yourapi -d --restart always -p 3000:3000 -e SQL_DSN="root:123456@tcp(localhost:3306)/oneapi" -e TZ=Asia/Shanghai -v /home/ubuntu/data/yourapi:/data yourapi/you-api:latest
```

## æ¸ é“é‡è¯•ä¸ç¼“å­˜
æ¸ é“é‡è¯•åŠŸèƒ½å·²ç»å®ç°ï¼Œå¯ä»¥åœ¨`è®¾ç½®->è¿è¥è®¾ç½®->é€šç”¨è®¾ç½®`è®¾ç½®é‡è¯•æ¬¡æ•°ï¼Œ**å»ºè®®å¼€å¯ç¼“å­˜**åŠŸèƒ½ã€‚

### ç¼“å­˜è®¾ç½®æ–¹æ³•
1. `REDIS_CONN_STRING`ï¼šè®¾ç½®Redisä½œä¸ºç¼“å­˜
2. `MEMORY_CACHE_ENABLED`ï¼šå¯ç”¨å†…å­˜ç¼“å­˜ï¼ˆè®¾ç½®äº†Redisåˆ™æ— éœ€æ‰‹åŠ¨è®¾ç½®ï¼‰

## æ¥å£æ–‡æ¡£

è¯¦ç»†æ¥å£æ–‡æ¡£è¯·å‚è€ƒ[æ¥å£æ–‡æ¡£](https://docs.newapi.pro/api)ï¼š

- [èŠå¤©æ¥å£ï¼ˆChatï¼‰](https://docs.newapi.pro/api/openai-chat)
- [å›¾åƒæ¥å£ï¼ˆImageï¼‰](https://docs.newapi.pro/api/openai-image)
- [é‡æ’åºæ¥å£ï¼ˆRerankï¼‰](https://docs.newapi.pro/api/jinaai-rerank)
- [å®æ—¶å¯¹è¯æ¥å£ï¼ˆRealtimeï¼‰](https://docs.newapi.pro/api/openai-realtime)
- [ClaudeèŠå¤©æ¥å£ï¼ˆmessagesï¼‰](https://docs.newapi.pro/api/anthropic-chat)

# è§£å†³ exec format error é—®é¢˜

å¦‚æœæ‚¨åœ¨è¿è¡Œ Docker å®¹å™¨æ—¶é‡åˆ° `exec /one-api: exec format error` é”™è¯¯ï¼Œè¿™é€šå¸¸æ˜¯ç”±äºæ‚¨çš„ç³»ç»Ÿæ¶æ„ï¼ˆå¦‚ ARM64ï¼‰ä¸é•œåƒæ„å»ºæ¶æ„ï¼ˆå¦‚ AMD64ï¼‰ä¸åŒ¹é…å¯¼è‡´çš„ã€‚

## è§£å†³æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¤šæ¶æ„æ„å»ºDockeré•œåƒ

```bash
# åˆ›å»ºå¹¶ä½¿ç”¨å¤šæ¶æ„æ„å»ºå™¨
docker buildx create --name mybuilder --use

# æ„å»ºå¹¶æ¨é€å¤šæ¶æ„é•œåƒ
docker buildx build --platform linux/amd64,linux/arm64 -t your-username/one-api:latest --push .
```

### æ–¹æ³•äºŒï¼šåœ¨æœ¬åœ°ä¸ºæ‚¨çš„æ¶æ„æ„å»ºé•œåƒ

```bash
# æŸ¥çœ‹æ‚¨çš„ç³»ç»Ÿæ¶æ„
uname -m

# ä¸ºç‰¹å®šæ¶æ„æ„å»ºé•œåƒ
docker build --build-arg TARGETARCH=$(uname -m | sed 's/x86_64/amd64/;s/aarch64/arm64/') -t one-api:local .
```

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨é¢„æ„å»ºçš„å¤šæ¶æ„é•œåƒ

å¦‚æœå¯ç”¨ï¼Œå°è¯•ä½¿ç”¨æ”¯æŒå¤šæ¶æ„çš„é¢„æ„å»ºé•œåƒï¼š

```bash
# åœ¨docker-compose.ymlä¸­å°†imageæ”¹ä¸º
# image: calciumion/new-api:multiarch
```

